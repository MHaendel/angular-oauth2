!function(e,t){"function"==typeof define&&define.amd?define(["angular","query-string"],t):"object"==typeof exports?module.exports=t(require("angular"),require("query-string")):e.angularOAuth2=t(e.angular,e.queryString)}(this,function(e,t){function r(e){e.interceptors.push("oauthInterceptor")}function n(){var r;this.configure=function(t){if(r)throw new Error("Already configured.");if(!(t instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return r=e.extend({},s,t),e.forEach(c,function(e){if(!r[e])throw new Error("Missing parameter: "+e+".")}),"/"===r.baseUrl.substr(-1)&&(r.baseUrl=r.baseUrl.slice(0,-1)),"/"!==r.grantPath[0]&&(r.grantPath="/"+r.grantPath),r},this.$get=function(e,n){var o=function(){function o(){if(!r)throw new Error("`OAuthProvider` must be configured first.")}return u(o,null,{isAuthenticated:{value:function(){return!!n.getToken()},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(o,a){if(!o||!o.username||!o.password)throw new Error("`user` must be an object with `username` and `password` properties.");var i={client_id:r.clientId,grant_type:"password",username:o.username,password:o.password};null!==r.clientSecret&&(i.client_secret=r.clientSecret),i=t.stringify(i);var u={headers:{"Content-Type":"application/x-www-form-urlencoded"}},s=""+r.baseUrl+r.grantPath;return"undefined"!=typeof a.provider&&(s=s+"/"+a.provider),e.post(s,i,u).then(function(e){return n.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){var o={client_id:r.clientId,grant_type:"refresh_token",refresh_token:n.getRefreshToken()};null!==r.clientSecret&&(o.client_secret=r.clientSecret),o=t.stringify(o);var a={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return e.post(""+r.baseUrl+r.grantPath,o,a).then(function(e){return n.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},revokeToken:{value:function(){return n.removeToken()},writable:!0,enumerable:!0,configurable:!0}}),o}();return new o},this.$get.$inject=["$http","OAuthToken"]}function o(){var t,r={name:"token",storage:"localstorage",options:{secure:!0}};this.configure=function(t){if(!(t instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return e.extend(r,t),r},this.$get=function(e){var n=function(){function e(){}return u(e,null,{token:{set:function(e){return o(e)},get:function(){return a()},enumerable:!0,configurable:!0},getAccessToken:{value:function(){return this.token?this.token.access_token:void 0},writable:!0,enumerable:!0,configurable:!0},getAuthorizationHeader:{value:function(){return this.getTokenType()&&this.getAccessToken()?""+(this.getTokenType().charAt(0).toUpperCase()+this.getTokenType().substr(1))+" "+this.getAccessToken():void 0},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){return this.token?this.token.refresh_token:void 0},writable:!0,enumerable:!0,configurable:!0},getTokenType:{value:function(){return this.token?this.token.token_type:void 0},writable:!0,enumerable:!0,configurable:!0},removeToken:{value:function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(){return i()}),writable:!0,enumerable:!0,configurable:!0}}),e}(),o=function(n){switch(t=r.storage.toLowerCase()){case"cookies":return e(r.name,n,r.options);case"localstorage":return localStorage.setItem(r.name,JSON.stringify(n));case"sessionstorage":return sessionStorage.setItem(r.name,JSON.stringify(n));default:return e(r.name,n,r.options)}},a=function(){switch(t=r.storage.toLowerCase()){case"cookies":return e(r.name);case"localstorage":return JSON.parse(localStorage.getItem(r.name));case"sessionstorage":return JSON.parse(sessionStorage.getItem(r.name));default:return e(r.name)}},i=function(){switch(t=r.storage.toLowerCase()){case"cookies":return e.remove(r.name,r.options);case"localstorage":return localStorage.removeItem(r.name);case"sessionstorage":return sessionStorage.removeItem(r.name);default:return e.remove(r.name,r.options)}};return new n},this.$get.$inject=["ipCookie"]}function a(e,t,r){return{request:function(e){return r.getAuthorizationHeader()&&(e.headers=e.headers||{},e.headers.Authorization=r.getAuthorizationHeader()),e},responseError:function(n){return(400===n.status&&n.data&&"invalid_grant"===n.data.error||n.data&&"invalid_request"===n.data.error||n.headers("www-authenticate")&&0===n.headers("www-authenticate").indexOf("Bearer"))&&(r.removeToken(),t.$emit("oauth:error",n)),(401===n.status&&n.data&&"invalid_grant"===n.data.error||n.data&&"access_denied"===n.data.error||n.headers("www-authenticate")&&0===n.headers("www-authenticate").indexOf("Bearer"))&&t.$emit("oauth:error",n),e.reject(n)}}}var i=e.module("angular-oauth2",["ngCookies"]).config(r).factory("oauthInterceptor",a).provider("OAuth",n).provider("OAuthToken",o);r.$inject=["$httpProvider"];var u=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)},s={baseUrl:null,clientId:null,clientSecret:null,grantPath:"/oauth2/token"},c=["baseUrl","clientId","grantPath"],u=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)};return a.$inject=["$q","$rootScope","OAuthToken"],i});